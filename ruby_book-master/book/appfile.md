# Файловая система Linux
[](appfile)

Файл - это фундаментальная абстракция в Linux (практически любая сущность считается файлом). Операции с файлами осуществляются с помощью файловых дескрипторов (цифровых идентификаторов).

## Типы файлов

+ _Обычный файл_ - файл, позволяющий вводить или выводить данные, а также перемещаться по ним с помощью буферизации (сохранения данных в буфер);

+ _Жесткая ссылка_ - файл, ссылающийся на другой файл.

  Жесткие ссылки необходимы, чтобы использовать нескольких имен для одного файла. При этом все жесткие ссылки равноправны - файл будет удален только в том случае, если удалены все жесткие ссылки на него.

  Изменение любой жесткой ссылки повлияет на связанный с ней файл.

  Создание жестких ссылок возможно только на одном физическом носителе информации (жестком диске, карте памяти и т.д.);

+ _Символьная ссылка (ярлык)_ - файл, ссылающийся на другой файл.

  Ярлыки необходимы, чтобы использовать нескольких имен для одного файла. При этом существует одно основное имя - файл будет удален только в том случае, если удален основной файл.
  1. Изменение любой символьной ссылки повлияет только на саму ссылку.
  2. Изменение основного файла повлияет на все связанные с ним ссылки;

+ _Блочное устройство_ - файл, обеспечивающий интерфейс доступа к какому-либо устройству.

  Ввод и вывод данных в блочные устройства выполняется в виде блоков, размер которых устанавливается блочным устройством. При этом существует возможность перемещаться по данным в пределах блочного устройства. Жесткий диск - это один из примеров блочных устройств;

+ _Символьное устройство_ - файл, обеспечивающий интерфейс доступа к какому-либо устройству.

  Ввод и вывод данных в символьное устройство выполняется в виде отдельных байтов. Обычно ввод и вывод данных не буферизуется и не существует возможности перемещаться по данным в пределах символьного устройства. Терминалы или модемы - это примеры символьных устройств.

+ _Сокет_ - файл, обеспечивающий коммуникацию между различными процессами, которые могут выполняться на разных компьютерах.

## Поиск файлов

Поиск файлов выполняется с помощью путей.

+ Путь в Ruby - это текст или любой другой объект, отвечающий на вызов метода `object.to_path`.
+ Путь в файловой системе - это полный список имен каталогов, (заканчивающийся именем самого файла), по которому может быть найден файл.

###### Виды путей:

+ _Абсолютный путь_ - путь к файлу, начинающийся от корневого каталога или буквы диска;  
  _Относительный путь_ - путь к файлу, относительно текущего каталога.


##### Спецсимволы:

+ Для перемещения на один каталог вверх, используется `..`;
+ Для обозначения текущего каталога используется `.`;
+ Для обозначения домашнего каталога используется `~`;
+ Для разделения каталогов в Windows используется символ обратной косой черты (`\`), а в Linux - символ косой черты (/);
+ Расширение файла отделяется точкой от его имени.

`*` - соответствует любому файлу или любой группе символов в имени файла;

`**` - соответствует любому каталогу в имени файла (включая символ разделителя);

`?` - соответствует любому одиночному символу в имени файла;

`[...]` - соответствует любому одному символу в имени файла из указанных в квадратных скобках;

`[^...]` - соответствует любому одному символу в имени файла, кроме указанных в квадратных скобках;

`{ }` - логическое или между символами, разделенными запятыми (Ruby 2.0).

*****

Также существует набор констант, влияющих на поиск.

##### Константы:

`File::FNM_SYSCASE` - чувствительность к регистру зависит от ОС (действует по умолчанию);

`File::FNM_CASEFOLD` - игнорирование регистра;

`File::FNM_PATHNAME` - спецсимвол ?, не будет соответствовать косой черте (символу разделителя);

`File::FNM_NOESCAPE` - обратная косая черта будет соответствовать самой себе, а не экранировать следующий символ;

`File::FNM_DOTMATCH` - знак точки в имени файла будет считаться частью имени, а не разделителем для расширения (используется для поиска скрытых файлов в Linux);

`File::FNM_EXTGLOB` - фигурные скобки в имени файла будут содержать выражение логического ИЛИ (Ruby 2.0).

*****

~~~~~ note
Использовать несколько констант можно с помощью выражения побитового ИЛИ. Тем, кто хочет разобраться почему это работает, следует изучить двоичную арифметику.
~~~~~

## Доступ к файлам

В некоторых файловых системах предусмотрена возможность ограничения доступа пользователей к содержимому файла. При этом обычно выделяют три типа прав: право на чтение, право на запись и право на выполнение.

Права доступа устанавливаются с помощью четырех целых чисел. Каждая цифра соответствует двоичному биту, добавляемому к файлу. Права доступа устанавливаются для определенного пользователя, определенной группы и для всех пользователей (идентификаторы пользователя и группы устанавливаются отдельно).

+ Первая цифра считается дополнительной и определяет либо различные способы запуска файла, либо дополнительное условие для каталогов;
+ Оставшиеся три цифры объявляют права доступа для пользователя, для группы и всех остальных пользователей соответственно.

Данные цифровые коды могут быть применены и в Windows. При этом допускается ограничивать доступ только для чтения и записи информации.

##### Основные права (permission):

`700` - пользователь имеет право на чтение, запись и выполнение;

`400` - пользователь имеет право на чтение;

`200` - пользователь имеет право на запись;

`100` - пользователь имеет право на выполнение (или право на просмотр каталога);

`70` - группа имеет право на чтение, запись и выполнение;

`40` - группа имеет право на чтение;

`20` - группа имеет право на запись;

`10` - группа имеет право на выполнение (или право на просмотр каталога);

`7` - все остальные пользователи имеют право на чтение, запись и выполнение;

`4` - все остальные пользователи имеют право на чтение;

`2` - все остальные пользователи имеют право на запись;

`1` - все остальные пользователи имеют право на выполнение файла (или право на просмотр каталога).

*****

По умолчанию файл выполняется от имени того пользователя, которым файл был запущен.

##### Дополнительные права:

`4000` - файл запускается от имени владельца;

`2000` - файл запускается от имени установленной группы пользователей;

`1000` - из каталога можно удалить только те файлы, владельцем которых является пользователь.

*****

Права доступа определяются после сложения чисел, объявляющих доступ для отдельных категорий пользователей.

_0444_ - любой пользователь имеет право только на чтение информации из файла.

Привилегии пользователей определяются с помощью цифровых идентификаторов. Каждый пользователь имеет четыре вида идентификаторов;

+ _UID_ - реальный идентификатор пользователя, запустившего файл;  
  _EUID_ - действующий идентификатор пользователя, с которым файл выполняется;  
  _GUID_ - реальный идентификатор группы, к которой относится пользователь, запустивший файл;  
  _EGUID_ - действующий идентификатор группы пользователей, с которым файл выполняется;

Для проверки привилегий пользователя обычно используется действующий идентификатор.

Доступ к файлу также может быть ограничен с помощью набора констант, передаваемых при открытии файла.

## Открытие файла

##### Константы:

`File::RDONLY` - файл открывается только для чтения;

`File::WRONLY` - файл открывается только для записи;

`File::RDWR` - файл открывается как для чтения, так и для записи;

`File::APPEND` - запись данных в конец файла (разрешение на запись необходимо устанавливать отдельно);

`File::CREAT` - создание нового файла. Определение владельца выполняется по действующему идентификатору. Определение группы выполняется по идентификатору группы для программы или для базового каталога;

`File::DIRECT` - ограничение кэширования содержимого файла;

`File::EXCL` - ограничение возможности создания ярлыков;

`File::NONBLOCK` - если система не готова выполнить запрос к файлу немедленно, то процесс выполнения не блокируется, а получает сигнал от системы;

`File::TRUNC` - новые данные сохраняются вместо существующих (разрешение на запись необходимо устанавливать отдельно);

`File::NOCTTY` - терминал открывается, но управление программой не передается;

`File::BINARY` - двоичный режим;

`File::SYNC, File::DSYNC, File::RSYNC` - cинхронное открытие файла. При записи в поток, он будет блокировать процесс выполнения до тех пор, пока информация не будет реально записана на устройство;

`File::NOFOLLOW` - открываются сами ярлыки, а не связанные с ними файлы;

`File::NOATIME` - время последнего доступа не обновляется.

*****