# Синтаксис регулярных выражений
[](appregexp)

**Во второй версии Ruby** для обработки регулярных выражений используется библиотека Onigmo: <http://github.com/k-takata/Onigmo>.

Также более подробное описание синтаксиса существует по адресу  
<http://perldoc.perl.org/perlre.html>.

##### Модификаторы:

`i` – поиск будет выполняться без учета регистра символов;

`m` – поиск будет выполняться в многострочном режиме. Точка в теле регулярного выражения будет соответствовать также и символу перевода строки;

`x` – пробельные символы (пробел, отступ, перевод строки) в теле регулярного выражения будут игнорироваться интерпретатором;

`o` – интерполяция в теле регулярного выражения будет выполняться только один раз, перед началом поиска;

`u, e, s, n` – тело регулярного выражения будет обрабатываться в указанной кодировке. Соответственно: u - UTF-8, e - EUC-JP , s - Windows-31J , n - ASCII-8BIT.

*****

##### ASCII символы:

`.` - соответствует любому символу в тексте (кроме символа перевода строки в однострочном режиме поиска);

`\w` - соответствует любой букве, цифре или знаку подчеркивания;

`\W` - соответствует любому символу, кроме букв, цифр или знаков подчеркивания;

`\s` - соответствует любому пробельному символу (пробел, отступ, перевод строки);

`\S` - соответствует любому символу, кроме пробельных;

`\d` - соответствует любой десятичной цифре;

`\D` - соответствует любому символу, кроме десятичных цифр;

`\h` - соответствует любой шестнадцатеричной цифре;

`\H` - соответствует любому символу, кроме шестнадцатеричных цифр.

*****

##### Unicode символы:

`\R` - **во второй версии Ruby** соответствует любому переводу строки, включая вертикальный отступ. Спецсимвол является аббревиатурой к non really.

Эквивалентно `(?>\x0D\x0A|[\x0A-\x0D\x{85}\x{2028}\x{2029}])` в Unicode
или `(?>\x0D\x0A|[\x0A-\x0D])` в другом случае.

~~~~~ ruby
  "\n" =~ /^\R$/   # -> 0
  "\r" =~ /^\R$/   # -> 0
  "\r\n" =~ /^\R$/ # -> 0
~~~~~

`\X` - **во второй версии Ruby** соответствует любому расширенному графическому символу в Unicode. Спецсимвол является аббревиатурой к eXtended Unicode character.  
`"P\u{307}" =~ /^\X$/ # -> 0`

`[[:класс:]]` -  соответствует любому символу, входящему в класс:

  + _alnum_  - буквы и цифры;  
    _alpha_  - буквы;  
    _ascii_  - ASCII символы;  
    _blank_  - пробел и отступ;  
    _cntrl_  - эмблемы составного текста;  
    _digit_  - десятичные цифры;  
    _graph_  - буквы, цифры и знаки препинания;  
    _lower_  - строчные буквы;  
    _print_  - буквы, цифры, знаки препинания и пробел;  
    _punct_  - знаки препинания;  
    _space_  - пробельные символы (пробел, отступ, перевод строки);  
    _upper_  - прописные буквы;  
    _word_   - буквы, цифры и специальные знаки препинания (знак подчеркивания);  
    _xdigit_ -шестнадцатеричные цифры;

`\p{класс}` - соответствует любому символу, входящему в класс.

`\p{^класс}` - соответствует любому символу, кроме входящих в класс.

  + _Alnum_    - буквы и цифры;  
    _Alpha_    - буквы;  
    _Any_      - Unicode символы;  
    _ASCII_    - ASCII символы;  
    _Assigned_ - свободные цифровые коды;  
    _Blank_    - пробел и отступ;  
    _Cntrl_    - эмблемы составного текста;  
    _Digit_    - десятичные цифры;  
    _Graph_    - буквы, цифры и знаки препинания;  
    _Lower_    - строчные буквы;  
    _Print_    - буквы, цифры, знаки препинания и пробел;  
    _Punct_    - знаки препинания;  
    _Space_    - пробельные символы (пробел, отступ, перевод строки);  
    _Upper_    - прописные буквы;  
    _Word_     - буквы, цифры и специальные знаки препинания (знак подчеркивания);  
    _Xdigit_   - шестнадцатеричные цифры.

*****

Unicode-классы символов:

+ C - остальные символы; Cc - спецсимволы; Cf - спецсимволы, влияющие на форматирование; Сn - свободные цифровые коды; Co - логотипы; Cs - символы-заменители;

+ L - буквы; Ll - строчные буквы; Lm - особые символы; Lo - остальные символы; Lt - буквы в начале слова; Lu - прописные буквы;

+ M – символы, использующиеся в связке; Mn - символы, изменяющие другие символы; Mc - специальные модификаторы, занимающие отдельную позицию в тексте; Me - символы, внутри которых могут находиться другие символы;

+ N - цифры; Nd - десятичные цифры; Nl - римские цифры; No - остальные цифры;

+ P - знаки препинания; Pc - специальные знаки препинания; Pd - дефисы и тире; Ps - открывающие скобки; Pe - закрывающие скобки; Pi - открывающие кавычки; Pf - закрывающие кавычки; Po - остальные знаки препинания;

+ S - декоративные символы; Sm - математические символы; Sc - символы денежных единиц;  Sk - составные декоративные символы; So - остальные декоративные символы;

+ Z - разделители, не имеющие графического представления; Zs - пробелы; Zl - перевод строки; Zp - перевод параграфа.

Также можно указать класс, определяющий алфавит. Поддерживаемые алфавиты: Arabic, Armenian, Balinese, Bengali, Bopomofo, Braille, Buginese, Buhid, Canadian_Aboriginal, Carian, Cham, Cherokee, Common, Coptic, Cuneiform, Cypriot, Cyrillic, Deseret, Devanagari, Ethiopic, Georgian, Glagolitic, Gothic, Greek, Gujarati, Gurmukhi, Han, Hangul, Hanunoo, Hebrew, Hiragana, Inherited, Kannada, Katakana, Kayah_Li, Kharoshthi, Khmer, Lao, Latin, Lepcha, Limbu, Linear_B, Lycian, Lydian, Malayalam, Mongolian, Myanmar, New_Tai_Lue, Nko, Ogham, Ol_Chiki, Old_Italic, Old_Persian, Oriya, Osmanya, Phags_Pa, Phoenician, Rejang, Runic, Saurashtra, Shavian, Sinhala, Sundanese, Syloti_Nagri, Syriac, Tagalog, Tagbanwa, Tai_Le, Tamil, Telugu, Thaana, Thai, Tibetan, Tifinagh, Ugaritic, Vai, and Yi.

##### Группировка символов:

`[...]` - соответствует любому символу из ограниченных квадратными скобками. Внутри квадратных скобок могут быть использованы диапазоны символов (a-z);

`[^...]` - соответствует любому символу, кроме ограниченных квадратными скобками;

`(?:...)` - символы объединяются в группу и используются как одна логическая единица;

`(...)` - символы объединяются в группу и используются как одна логическая единица. Группе будет присвоен порядковый номер (от 1 до 9);

`(?<идентификатор>...)` - символы объединяются в группу и используются как одна логическая единица. Группе будет присвоен указанный идентификатор.

*****

Если лексема регулярного выражения использовалось в качестве левого операнда, тогда, после выполнения выражения, идентификаторы групп ссылаются на текст совпадения, или на nil, если совпадений не найдено. Идентификаторы групп объявляются как локальные переменные.

Глобальные переменные от $1 до $9 также ссылаются на текст совпадения с группой, имеющей указанный номер.

##### Группы символов:

`\целое_число` - соответствует тексту совпадения с группой, имеющей указанный номер;

`\K <идентификатор>` - соответствует тексту совпадения с группой, имеющей указанный идентификатор;

`\g <...>` - соответствует тексту совпадения с группой, имеющей указанный порядковый номер или идентификатор. **Во второй версии Ruby** добавлен расширенный синтаксис (см. документацию для Onigmo).

*****

##### Повторы:

`...?` - соответствует от 0 до 1 повторам символа или группы;

`...*` - соответствует 0 и более повторам символа или группы. Результат поиска содержит максимально возможное совпадение (жадный алгоритм);

`...*?` - соответствует 0 и более повторам символа или группы. Результат поиска содержит минимально возможное совпадение (не жадный алгоритм);

`...+` - соответствует 1 и более повторам символа или группы. Результат поиска содержит максимально возможное совпадение (жадный алгоритм);

`...+?` - соответствует 1 и более повторам символа или группы. Результат поиска содержит минимально возможное совпадение (не жадный алгоритм);

`...{a, b}` - соответствует от a до b повторам символа или группы. Результат поиска содержит максимально возможное совпадение (жадный алгоритм);

`...{a, b}?` - соответствует от a до b повторам символа или группы. Результат поиска содержит минимально возможное совпадение (не жадный алгоритм).

В обоих случаях допускается отсутствие a, b, или запятой.

*****

##### Положение в тексте:

`^...` - соответствует символу или группе в начале строки;

`...$` - соответствует символу или группе в конце строки;

`\A...` - соответствует символу или группе в начале текста;

`...\z` - соответствует символу или группе в конце текста;

`...\Z` - соответствует символу или группе в конце текста или перед последним символом перевода строки, замыкающим текст;

`...\b` - соответствует символу или группе в конце слова;

`\b...` - соответствует символу или группе в начале слова;

`...\B` - соответствует символу или группе в любом месте, кроме конца слова;

`\B...` - соответствует символу или группе в любом месте, кроме начала слова.

*****

+ Использование идиомы `/^...$/` для проверки полного совпадения текста с образцом потенциально может привести к небезопасному коду. Чтобы избежать этого, в данном случае, лучше использовать `/\A...\z/`.

+ Идиома `\b...\b` часто используется для поиска отдельных слов в тексте.

##### Логические условия:

`№1|№2` - объединение множеств;

`№1&&№2` - пересечение множеств;

`№1(?=№2)` - соответствует символам №1, если символы №2 встречаются далее по тексту (позитивное заглядывание вперед);

`№1(?!№2)` - соответствует символам №1, если символы №2 не встречаются далее по тексту (негативное заглядывание вперед);

`№1(?<=№2)` - соответствует символам №1, если символы №2 встречаются в предыдущей части текста (позитивное заглядывание назад);

`\K` - **во второй версии Ruby** любой шаблон, находящийся слева от спецсимвола не будет добавлен к тексту совпадения (и соответственно не будет изменяться при замене совпадений).

Эквивалентно позитивному заглядыванию назад (`/№1 \K №2/` и `/(?<=№1) №2/`).

Спецсимвол является аббревиатурой к keep.

`№1(?<!№2)` - соответствует символам №1, если символы №2 не встречаются в предыдущей части текста (негативное заглядывание вперед).

`(?(cond)yes|no)` - **во второй версии Ruby** в зависимости от условия выполняется поиск совпадения с той или иной группой. Условием может быть совпадение с группой или идентификатор или даже заглядывание вперед/назад.

~~~~~ ruby
  regexp = /^([A-Z])?[a-z]+(?(1)[A-Z]|[a-z])$/

  regexp =~ "foo"   # -> 0
  regexp =~ "foO"   # -> nil
  regexp =~ "FoO"   # -> 0
~~~~~

*****

##### Остальное:

`(?#...)` - игнорируемый комментарий;

`(?>...)` - в любом случае соответствует указанным символам;

`(?№1-№2)` - применяет модификаторы №1 и отменяет модификаторы №2 для дальнейшего поиска;

`(?№1-№2:...)` - применяет модификаторы №1 и отменяет модификаторы №2 для символов или групп.

*****